# Maintainer: Chris Cromer <cromer@artixlinux.org>
# Maintainer: artoo <artoo@artixlinux.org>

pkgname=opensysusers
pkgver=0.4.5
pkgrel=1
pkgdesc="A standalone utility for handling systemd-style sysusers.d users and groups"
arch=('any')
url="https://github.com/artix-linux/opensysusers"
license=('BSD2')
depends=('pacman')
makedepends=('docbook-xsl')
source=("${pkgname}-${pkgver}.tar.gz::https://github.com/artix-linux/opensysusers/archive/${pkgver}.tar.gz"
		'opensysusers.hook'
		'sysusers-hook')
sha256sums=('b0dc09caf5f97a2e9156716809e74835d0fecbf0432c6cec4626a943e8e58bd4'
            'cefc133d78851cc3838eec273aeb127814c955be21c6e3fc0f9ba4391e534ec2'
            '4222b2496d8bb1ac9c07707e4ef1b334b8b59eb15451ea8ba0fd6e4c93e50c56')

prepare(){
    cd "${srcdir}/${pkgname}-${pkgver}"
}

build(){
    cd "${srcdir}/${pkgname}-${pkgver}"
    make PREFIX=/usr BINNAME=sysusers DESTDIR="${pkgdir}"
}

package() {
    cd "${srcdir}/${pkgname}-${pkgver}"
    make PREFIX=/usr BINNAME=sysusers DESTDIR="${pkgdir}" install

    install -vDm0755 openrc/opensysusers.initd "${pkgdir}"/etc/init.d/opensysusers
    install -dm0755 "${pkgdir}/etc/runlevels/boot"
    ln -snf "/etc/init.d/opensysusers" "${pkgdir}/etc/runlevels/boot/opensysusers"

    # pacman hooks
    install -Dm755 ${srcdir}/sysusers-hook "$pkgdir"/usr/share/libalpm/scripts/sysusers-hook
    install -Dm644 -t "$pkgdir"/usr/share/libalpm/hooks ${srcdir}/*.hook

    ln -snf "/usr/bin/sysusers" "${pkgdir}/usr/bin/systemd-sysusers"
}
