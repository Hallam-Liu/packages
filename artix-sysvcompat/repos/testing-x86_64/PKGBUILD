# Maintainer: Muhammad Herdiansyah <koni@artixlinux.org>
# Maintainer: artoo <artoo@artixlinux.org>

_pkgname=halt

pkgname=artix-sysvcompat
pkgver=0.3.7
pkgrel=6
pkgdesc="Artix Linux's wrapper program for OpenRC and runit's init & shutdown scheme"
arch=('x86_64')
groups=('base')
url="https://github.com/artix-linux/halt"
depends=('svc-manager')
conflicts=('sysvinit' 'systemd-sysvcompat')
replaces=('sysvinit')
license=('BSD')
source=("$url/archive/${pkgver}/${_pkgname}-${pkgver}.tar.gz"
        'initswitch-hook'
        'initswitch.hook')
sha256sums=('0b8ac1cfd75e76151ddbe2c0395ee8463c34b6e3c464922355cfb58818c98748'
            '70fadd670828f5838531e6ccac32e7d6e577517f86f2f3e01dff66c5cc7e1265'
            '33c72a2a62548bf2ac11e7ebd0e7e2d953f860e1ec921301fd336f6cd2c7e68b')

build() {
	cd "${_pkgname}-${pkgver}"
	make
}

package() {
	cd "${_pkgname}-${pkgver}"
	make DESTDIR="${pkgdir}" install

	install -Dm644 "COPYING" "${pkgdir}/usr/share/licenses/halt/COPYING"

	# pacman hooks
    install -Dm755 ${srcdir}/initswitch-hook "${pkgdir}"/usr/share/libalpm/scripts/initswitch-hook
    install -Dm644 -t "${pkgdir}"/usr/share/libalpm/hooks ${srcdir}/*.hook

    # provide default symlink for PM file tracking
    install -d "${pkgdir}"/usr/bin
    ln -sf openrc-init "${pkgdir}"/usr/bin/init
}
